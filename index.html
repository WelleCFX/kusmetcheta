<!DOCTYPE html>
<html lang="bg">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
  <title>H-BDAY,LOVE üíå</title>
  <meta name="description" content="73 –∫—ä—Å–º–µ—Ç—á–µ—Ç–∞ –∑–∞ –ú–µ–ª–∏—Å–∞ ‚Äì –ø–æ –µ–¥–Ω–æ –Ω–∞ –¥–µ–Ω. –° –ª—é–±–æ–≤.">
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="–ö—ä—Å–º–µ—Ç—á–µ—Ç–∞">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <link rel="apple-touch-icon" href="icons/icon-180.png">
  <meta name="theme-color" content="#1a1b3a">
  <style>
    :root{
      --bg1:#0f1020;
      --bg2:#1a1b3a;
      --card:#111226dd;
      --text:#ffffff;
      --muted:#c7c9ff;
      --btn:#27284a;
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius: 20px;
      --accent1:#ff6ec7;
      --accent2:#7c5cff;
      --lav1:#9b8cff;
      --lav2:#6d5bff;
      --chip:#262751;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-rounded, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Inter, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji", "Segoe UI Symbol", sans-serif;
      color:var(--text);
      background: radial-gradient(1200px 600px at 20% -10%, #1e214a 0%, transparent 60%),
                  radial-gradient(900px 600px at 120% 10%, #401b49 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      display:flex; align-items:center; justify-content:center; padding:22px;
    }
    .app{ width:100%; max-width:600px; }
    .card{
      background:var(--card);
      border:1px solid rgba(255,255,255,.08);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      position:relative;
      overflow:hidden;
    }
    h1{ margin:0 0 10px; font-size:26px; display:flex; align-items:center; gap:10px; }
    .subtitle{ color:var(--muted); font-size:14px; margin-bottom:18px; }
    .fortune{
      min-height:120px; display:flex; align-items:center; justify-content:center;
      text-align:center; font-size:22px; line-height:1.35; padding:18px; border-radius:16px;
      background:rgba(255,255,255,.05); border:1px dashed rgba(255,255,255,.12); margin-bottom:16px;
      word-break:break-word;
    }
    .chips{display:flex; flex-wrap:wrap; gap:8px; margin-bottom:10px}
    .chip{
      display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px;
      font-size:12px; border:1px solid rgba(255,255,255,.16); color:#fff; background:var(--chip);
      opacity:.9; user-select:none; pointer-events:none;
    }
    .chip .dot{width:8px; height:8px; border-radius:999px; display:inline-block}
    .row{display:flex; flex-direction:column; gap:10px}
    button{
      appearance:none; border:none; cursor:pointer; color:#fff;
      padding:14px 16px; border-radius:14px; font-weight:700; letter-spacing:.2px; font-size:16px;
      box-shadow: 0 6px 14px rgba(0,0,0,.25);
      transition: transform .06s ease, opacity .2s ease, background .2s ease;
      width:100%;
    }
    button:active{ transform: translateY(1px) scale(.99); }
    button:disabled{ opacity:.6; cursor:not-allowed; }
    .btn-primary{ background: linear-gradient(135deg, var(--accent1), var(--accent2)); }
    .btn-reset{ background: linear-gradient(135deg, var(--lav1), var(--lav2)); }
    footer{margin-top:16px; text-align:center; color:var(--muted); font-size:12px}
    .hidden{display:none}
    .notice{ font-size:13px; color:#ffd166; margin:6px 0 0 2px; text-align:center; }

    /* Intro overlay */
    .intro{
      position:fixed; inset:0; display:flex; align-items:center; justify-content:center;
      background: radial-gradient(900px 600px at 20% -10%, #1e214a 0%, transparent 60%), rgba(10,11,24,.96);
      z-index:9999; transition: opacity .4s ease, visibility .4s ease;
    }
    .intro.hidden{opacity:0; visibility:hidden}
    .intro-card{
      width:min(92vw,560px);
      background:var(--card); border:1px solid rgba(255,255,255,.12);
      border-radius:22px; padding:26px; text-align:center; box-shadow:var(--shadow);
      backdrop-filter: blur(8px);
      animation: pop .35s ease-out;
    }
    .intro h2{margin:0 0 8px; font-size:26px}
    .intro p{margin:0 0 16px; color:var(--muted)}
    .intro button{width:auto; padding:12px 18px}
    @keyframes pop{from{transform:scale(.96); opacity:.6} to{transform:scale(1); opacity:1}}

    /* Simple confetti emoji */
    .confetti{
      position:fixed; pointer-events:none; left:0; top:0; width:100%; height:100%; overflow:hidden; z-index:10000;
    }
    .confetti span{
      position:absolute; font-size:20px; animation: fall linear forwards;
    }
    @keyframes fall{
      to{ transform: translateY(110vh) rotate(360deg); opacity:0.9; }
    }
  
.modal.hidden{display:none}
.modal{position:fixed;inset:0;z-index:60}
.modal__backdrop{position:absolute;inset:0;background:rgba(0,0,0,.45);backdrop-filter:blur(2px)}
.modal__dialog{position:relative;margin:8vh auto 0 auto;max-width:600px;background:#111226;border:1px solid rgba(255,255,255,.12);border-radius:20px;box-shadow:0 20px 60px rgba(0,0,0,.4);padding:16px}
.modal__header,.modal__footer{display:flex;align-items:center;justify-content:space-between;gap:8px}
.modal__title{font-weight:800;font-size:18px}
.modal__body{max-height:50vh;overflow:auto;padding:8px 0}
.history-list{list-style:none;margin:0;padding:0}
.history-list li{padding:10px 12px;border:1px solid rgba(255,255,255,.06);border-radius:12px;margin-bottom:8px;display:flex;justify-content:space-between;gap:10px}
.history-list .t{opacity:.9}
.history-list .d{opacity:.7;font-size:12px;white-space:nowrap}

</style>
</head>
<body>
  <div class="intro" id="intro">
    <div class="intro-card">
      <h2>–ó–¥—Ä–∞–≤–µ–π, –õ—é–±–æ–≤ üíñ</h2>
      <p>–ì–æ—Ç–æ–≤–∞ –ª–∏ —Å–∏ –∑–∞ –¥–Ω–µ—à–Ω–æ—Ç–æ –∫—ä—Å–º–µ—Ç—á–µ?</p>
      <button id="introBtn" class="btn-primary">–î–∞! –û—Ç–≤–æ—Ä–∏ –≥–æ üé≤</button>
    </div>
    <div class="confetti" id="confetti"></div>
  </div>

  <div class="app">
    <div class="card">
      <h1>–ß–µ—Å—Ç–∏—Ç —Ä–æ–∂–¥–µ–Ω –¥–µ–Ω, –ª—é–±–æ–≤! üíå</h1>
      <div class="subtitle">–ß–µ—Å—Ç–∏—Ç —Ä–æ–∂–¥–µ–Ω –¥–µ–Ω, –õ—é–±–æ–≤!.</div>
	  
	  <div class="subtitle">–ñ–µ–ª–∞—è —Ç–∏ –Ω–∞–π-–≤–µ—á–µ –¥–∞ —Å–∏ –∂–∏–≤–∞ –∏ –∑–¥—Ä–∞–≤–∞,–ª—é–±–æ–≤—Ç–∞,–≥—Ä–∏–∂–∞—Ç–∞ –∏ —â–∞—Å—Ç–∏–µ—Ç–æ —â–µ —Ç–∏ –≥–æ –¥–∞–º!</div>
	  
      <div class="subtitle">–ü—Ä–∏–≥–æ—Ç–≤–∏–ª —Å—ä–º —Ç–∏ –ø–æ-–µ–¥–Ω–æ –∫—ä—Å–º–µ—Ç—á–µ –∑–∞ –≤—Å–µ–∫–∏ –¥–µ–Ω –¥–æ –Ω–æ–≤–∞ –≥–æ–¥–∏–Ω–∞, –Ω–µ –∑–∞–±—Ä–∞–≤—è–π –¥–∞ –≥–æ –æ—Ç–≤–∞—Ä—è—à!</div>

      <div id="fortune" class="fortune">–ù–∞—Ç–∏—Å–Ω–∏ ‚Äû–û—Ç–≤–æ—Ä–∏ –∫—ä—Å–º–µ—Ç—á–µ, –ú–µ–ª–∏—Å–∞‚Äú üé≤</div>

      <div class="chips" id="cats"></div>

      <div class="chips">
        <span class="chip">–û—Å—Ç–∞–≤–∞—Ç: <span id="left">73</span></span>
        <span class="chip">–î–Ω–µ—Å: <span id="todayInfo">‚Äî</span></span>
      </div>

      <div class="row">
        <button id="randomBtn" class="btn-primary">üé≤ –û—Ç–≤–æ—Ä–∏ –∫—ä—Å–º–µ—Ç—á–µ, –ú–µ–ª–∏—Å–∞</button>
        <button id="historyBtn" class="btn-reset">üìú –ò—Å—Ç–æ—Ä–∏—è</button>
        <button id="resetBtn" class="btn-reset">üîÅ –†–µ—Å—Ç–∞—Ä—Ç (—Ç–µ—Å—Ç)</button>
      </div>
      <div id="limitNote" class="notice hidden">–í–µ—á–µ –æ—Ç–≤–æ—Ä–∏ –∫—ä—Å–º–µ—Ç—á–µ –¥–Ω–µ—Å. –û–ø–∏—Ç–∞–π —É—Ç—Ä–µ! üåô</div>

      <footer>–°—ä–∑–¥–∞–¥–µ–Ω–æ —Å –º–Ω–æ–≥–æ –ª—é–±–æ–≤ ‚ù§Ô∏è ‚Äî –ò–≤–∞–Ω –ú–∏—Ö–æ–≤</footer>
    </div>
  </div>

  <script>
    // PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js').catch(()=>{});
      });
    }

    // Intro overlay logic ‚Äî show on *every* app open
    const introEl = document.getElementById('intro');
    const introBtn = document.getElementById('introBtn');
    function showIntro(){
      introEl.classList.remove('hidden');
      launchConfetti();
    }
    function hideIntro(){
      introEl.classList.add('hidden');
    }
    introBtn.addEventListener('click', ()=>{
      hideIntro();
      document.getElementById('randomBtn').focus();
    });
    // show immediately on load
    document.addEventListener('DOMContentLoaded', showIntro);

    function launchConfetti(){
      const c = document.getElementById('confetti');
      c.innerHTML = '';
      const emojis = ['üíñ','‚ú®','üéâ','üíï','üåü','üí´'];
      for(let i=0;i<40;i++){
        const s = document.createElement('span');
        s.textContent = emojis[Math.floor(Math.random()*emojis.length)];
        s.style.left = Math.random()*100 + 'vw';
        s.style.top = - (Math.random()*20 + 5) + 'vh';
        s.style.animationDuration = (Math.random()*2 + 3) + 's';
        s.style.opacity = 0.8;
        c.appendChild(s);
        setTimeout(()=> s.remove(), 6000);
      }
    }

    const CAT_COLORS = {
      "–†–æ–º–∞–Ω—Ç–∏–∫–∞":"#ff6ec7",
      "–°–ø–æ–º–µ–Ω–∏":"#76c7ff",
      "–ñ–µ—Å—Ç–æ–≤–µ":"#66ffa3",
      "–°–º—è—Ö":"#ffd166",
      "–ú–µ—á—Ç–∏":"#a2ffea",
      "–ü–∞–ª–∞–≤–æ":"#c18cff",
      "–ò–∑–Ω–µ–Ω–∞–¥–∞":"#ff9f7f"
    };
    const CAT_NAMES = Object.keys(CAT_COLORS);

    const fortunes = [
      // –†–æ–º–∞–Ω—Ç–∏–∫–∞ (13)
      ["–û–±–∏—á–∞–º —Ç–µ, –∫–∞–∫—Ç–æ –Ω–µ —Å—ä–º –æ–±–∏—á–∞–ª –Ω–∏–∫–æ–≥–æ –¥–æ —Å–µ–≥–∞!.", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "‚ù§Ô∏è"],
      ["–î–æ —Ç–µ–± —Å–µ —á—É–≤—Å—Ç–≤–∞–º —É –¥–æ–º–∞!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üè°"],
      ["–¢–∏ –ø—Ä–∞–≤–∏—à –∏ –æ–±–∏–∫–Ω–æ–≤–µ–Ω–∏—è –¥–µ–Ω —Å–ø–µ—Ü–∏–∞–ª–µ–Ω!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "‚ú®"],
      ["–ù–∞–π-—Ö—É–±–∞–≤–æ—Ç–æ ‚Äú—Å–ª—É—á–∞–π–Ω–æ‚Äù –≤ –∂–∏–≤–æ—Ç–∞ –º–∏ —Å–∏ —Ç–∏.", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üíï"],
      ["–ö–æ–≥–∞—Ç–æ —Å–∏ –¥–æ –º–µ–Ω, –∑–∞–±—Ä–∞–≤—è–º –∑–∞ –≤—Å–∏—á–∫–æ –æ—Å—Ç–∞–Ω–∞–ª–æ!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üåÖ"],
      ["–¢–∏ —Å–∏ –ø–æ–ª–æ–≤–∏–Ω–∫–∞—Ç–∞, –∫–æ—è—Ç–æ –º–∏ –µ –ª–∏–ø—Å–≤–∞–ª–∞ –¥–æ —Å–µ–≥–∞!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üíñ"],
      ["–° —Ç–µ–± –∏ —Ç–∏—à–∏–Ω–∞—Ç–∞ –µ —Å–ª–∞–¥–∫–∞!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üåô"],
      ["–ë–ª–∞–≥–æ–¥–∞—Ä–µ–Ω —Å—ä–º, —á–µ —Ç–µ –∏–º–∞–º!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üôè"],
      ["–í—Å–µ–∫–∏ –º–æ–º–µ–Ω—Ç —Å —Ç–µ–± —Å–∏ –∑–∞—Å–ª—É–∂–∞–≤–∞!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "ü•∞"],
      ["–¢–∏ —Å–∏ –º–æ–µ—Ç–æ –ª—é–±–∏–º–æ ‚Äû–∑–∞–≤–∏–Ω–∞–≥–∏‚Äú!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üíç"],
      ["–î–æ—Ä–∏ –∫–æ–≥–∞—Ç–æ –º—ä–ª—á–∏–º, —Å—ä—Ä—Ü–µ—Ç–æ –º–∏ –≥–æ–≤–æ—Ä–∏ —Å —Ç–≤–æ–µ—Ç–æ!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üíò"],
      ["–¢–∏ —Å–∏ –º–æ–µ—Ç–æ —É—Ç—Ä–µ, –∫–æ–µ—Ç–æ —á–∞–∫–∞–º —Å —É—Å–º–∏–≤–∫–∞!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "üåû"],
      ["–° —Ç–µ–± ‚Äû–∑–∞–≤–∏–Ω–∞–≥–∏‚Äú –∑–≤—É—á–∏ –∫–∞—Ç–æ –ø–ª–∞–Ω, –Ω–µ –º–µ—á—Ç–∞!", "–†–æ–º–∞–Ω—Ç–∏–∫–∞", "‚àû"],

      // –°–ø–æ–º–µ–Ω–∏ (10)
      ["–ù–∏–∫–æ–≥–∞ –Ω—è–º–∞ –¥–∞ –∑–∞–±—Ä–∞–≤—è –ø—ä—Ä–≤–∞—Ç–∞ –Ω–∏ —Å—Ä–µ—â–∞ –æ–∫–æ–ª–æ –∫–æ–ª–∞—Ç–∞.", "–°–ø–æ–º–µ–Ω–∏", "üöò"],
      ["–ü–æ—á–∏–≤–∫–∏—Ç–µ –Ω–∏ —Å–∞ –º–æ–∏—Ç–µ –ª—é–±–∏–º–∏ —Å–ø–æ–º–µ–Ω–∏.", "–°–ø–æ–º–µ–Ω–∏", "üå¥"],
      ["–ü–æ–º–Ω–∏—à –ª–∏ –ø—ä—Ä–≤–∞—Ç–∞ –≤–µ—á–µ—Ä, –∫–æ–≥–∞—Ç–æ —Å–µ —Å–º–µ–µ—Ö–º–µ –¥–æ –∫—ä—Å–Ω–æ?", "–°–ø–æ–º–µ–Ω–∏", "üåÉ"],
      ["–í—Å–µ–∫–∏ –ø—ä—Ç, –∫–æ–≥–∞—Ç–æ –∫–∞—Ä–∞–º–µ –∑–∞–µ–¥–Ω–æ, —Å–µ —á—É–≤—Å—Ç–≤–∞–º –∂–∏–≤.", "–°–ø–æ–º–µ–Ω–∏", "üí®"],
      ["–ú–æ–º–µ–Ω—Ç–∏ —Å —Ç–µ–± –≤–∏–Ω–∞–≥–∏ —Å–∞ –º–∞–ª–∫–∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è.", "–°–ø–æ–º–µ–Ω–∏", "üèûÔ∏è"],
      ["–ü–æ–º–Ω–∏—à –ª–∏ –∫–∞–∫ —Ç–∏ –Ω–∞—Å—Ç—ä–ø–∞–∫ –∫–ª–∏–Ω—á–µ—Ç–æ –∏ –ø–∞–¥–Ω–∞?", "–°–ø–æ–º–µ–Ω–∏", "üèïÔ∏è"],
      ["–ö–∞—Ç–æ –≥–ª–µ–¥–∞–º —Å–Ω–∏–º–∫–∏—Ç–µ –Ω–∏, —É—Å–º–∏–≤–∫–∞—Ç–∞ –Ω–µ —Å–ª–∏–∑–∞ –æ—Ç –ª–∏—Ü–µ—Ç–æ –º–∏.", "–°–ø–æ–º–µ–Ω–∏", "üì∏"],
      ["–õ—é–±–∏–º–∏—è—Ç –º–∏ —Å–ø–æ–º–µ–Ω –µ –ø—Ä–æ—Å—Ç–æ –¥–∞ —Å—ä–º –¥–æ —Ç–µ–±.", "–°–ø–æ–º–µ–Ω–∏", "ü•∞"],
      ["–ü–æ–º–Ω–∏—à –ª–∏ –∫–∞–∫ —Å–µ –∑–∞–±–∞–≤–ª—è–≤–∞—Ö–º–µ –Ω–∞ –ø–ª–∞–∂–∞ –≤ –ì—ä—Ä—Ü–∏—è ?", "–°–ø–æ–º–µ–Ω–∏", "üèñÔ∏è"],
      ["–¢–∏ –ø—Ä–∞–≤–∏—à –¥–æ—Ä–∏ —Å–∫—É—á–Ω–∏—Ç–µ –º–æ–º–µ–Ω—Ç–∏ –Ω–µ–∑–∞–±—Ä–∞–≤–∏–º–∏.", "–°–ø–æ–º–µ–Ω–∏", "üåü"],

      // –ñ–µ—Å—Ç–æ–≤–µ (10)
      ["–¢–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ —Ç–∏ –¥—ä–ª–∂–∞ –ø–æ-–µ–¥–∏–Ω –º–∞—Å–∞–∂ –≤—Å–µ–∫–∏ –¥–µ–Ω!", "–ñ–µ—Å—Ç–æ–≤–µ", "üíÜ‚Äç‚ôÄÔ∏è"],
      ["–£—Ç—Ä–µ —â–µ –≥—É—à–∫–∞–º –ø–æ–≤–µ—á–µ –æ—Ç –æ–±–∏–∫–Ω–æ–≤–µ–Ω–æ.", "–ñ–µ—Å—Ç–æ–≤–µ", "ü§ó"],
      ["–°–ª–µ–¥–≤–∞—â–∞—Ç–∞ —Ä–∞–∑—Ö–æ–¥–∫–∞ –µ —Å–∞–º–æ –∑–∞ –Ω–∞—Å –¥–≤–∞–º–∞—Ç–∞.", "–ñ–µ—Å—Ç–æ–≤–µ", "üö∂‚Äç‚ôÄÔ∏è"],
      ["–©–µ –Ω–∞–ø—Ä–∞–≤—è –ª—é–±–∏–º–∞—Ç–∞ —Ç–∏ –∑–∞–∫—É—Å–∫–∞!", "–ñ–µ—Å—Ç–æ–≤–µ", "ü•ê"],
      ["–¢–∏ –∏–∑–±–∏—Ä–∞—à —Ñ–∏–ª–º–∞, –∞–∑ –∫—É–ø—É–≤–∞–º –ø—É–∫–∞–Ω–∫–∏—Ç–µ.", "–ñ–µ—Å—Ç–æ–≤–µ", "üçø"],
      ["–î–Ω–µ—Å —â–µ –æ—Ç–∏–¥–µ–º –Ω–∞ –∫–∏–Ω–æ!", "–ñ–µ—Å—Ç–æ–≤–µ", "üíå"],
      ["–î–Ω–µ—Å —Ç—Ä—è–±–≤–∞ –¥–∞ –∏–∑–∫–ª—é—á–∏–º —Ç–µ–ª–µ—Ñ–æ–Ω–∏—Ç–µ –∏ –¥–∞ –ø—Ä–∞–≤–∏–º –∫–∞–∫–≤–æ—Ç–æ –∂–µ–ª–∞–µ—à!", "–ñ–µ—Å—Ç–æ–≤–µ", "üìµ"],
      ["–¢–∞–∑–∏ –≤–µ—á–µ—Ä –µ —Å–∞–º–æ –∑–∞ –Ω–∞—Å –¥–≤–∞–º–∞—Ç–∞!", "–ñ–µ—Å—Ç–æ–≤–µ", "üïØÔ∏è"],
      ["–©–µ —Ç–µ —Ä–∞–∑–≤–µ—Å–µ–ª—è, –¥–æ—Ä–∏ –∞–∫–æ –¥–µ–Ω—è—Ç –µ —Ç–µ–∂—ä–∫.", "–ñ–µ—Å—Ç–æ–≤–µ", "üòá"],
      ["–ú–∞–ª–∫–∏ –∂–µ—Å—Ç–æ–≤–µ –∑–∞ —Ç–µ–±, –∑–∞ –¥–∞ –∑–Ω–∞–µ—à –∫–æ–ª–∫–æ –∑–Ω–∞—á–∏—à.", "–ñ–µ—Å—Ç–æ–≤–µ", "üå∏"],

      // –°–º—è—Ö (10)
      ["–ê–∫–æ –æ—Ü–µ–ª–µ–µ–º —Å–ª–µ–¥ –º–∞–¥–∂—É–Ω–∞‚Ä¶ —â–µ –æ—Ü–µ–ª–µ–µ–º —Å–ª–µ–¥ –≤—Å–∏—á–∫–æ!", "–°–º—è—Ö", "üòÇ"],
      ["Y1312BA = –Ω–∞—à–µ—Ç–æ —Ç–∞–π–Ω–æ –ª—é–±–æ–≤–Ω–æ —Ç–∞–∫—Å–∏.", "–°–º—è—Ö", "üöó"],
      ["–ü–æ–º–Ω–∏—à –ª–∏ –∫–∞–∫ —Å–µ —Å–º–µ–µ—Ö–º–µ –¥–æ —Å—ä–ª–∑–∏ –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω–∞—Ç–∞ –Ω–∏ –ø–æ—á–∏–≤–∫–∞?", "–°–º—è—Ö", "üòÜ"],
      ["–¢—É–ª–∫–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞–∞.", "–°–º—è—Ö", "üòú"],
      ["–ù–∏–∫–æ–π –Ω–µ –º–µ –∫–∞—Ä–∞ –¥–∞ —Å–µ —á—É–≤—Å—Ç–≤–∞–º —Ç–æ–ª–∫–æ–≤–∞ –≥–ª—É–ø–∞–≤–æ —â–∞—Å—Ç–ª–∏–≤.", "–°–º—è—Ö", "ü§£"],
      ["–¢–∏ —Å–∏ –ø—Ä–∏—á–∏–Ω–∞—Ç–∞ –¥–∞ —Å–µ —Å–º–µ—è –±–µ–∑ –ø—Ä–∏—á–∏–Ω–∞.", "–°–º—è—Ö", "üòÑ"],
      ["–ê–∫–æ –Ω—è–∫–æ–π –¥–µ–Ω –∑–∞–±—Ä–∞–≤—è —Å–º–µ—à–Ω–∏—Ç–µ —Ç–∏ –Ω–∞–≤–∏—Ü–∏, –Ω–∞–ø–æ–º–Ω–∏ –º–∏!", "–°–º—è—Ö", "üòâ"],
      ["–¢–∞–∑–∏ –≥–æ–¥–∏–Ω–∞ —Ö–≤–∞–Ω–∞ –±—É–∫–µ—Ç–∞,–¥–æ–≥–æ–¥–∏–Ω–∞ –º–∏—Å–ª—è –¥–∞ –≥–æ –¥—ä—Ä–∂–∏—à!", "–°–º—è—Ö", "üîî"],
      ["–í–∞–∂–Ω–æ –µ, —á–µ –∏–º–∞–º–µ ‚Äû–Ω–∞—à–∏—Ç–µ‚Äú –≥–ª—É–ø–∞–≤–∏ –º–æ–º–µ–Ω—Ç–∏.", "–°–º—è—Ö", "üòÖ"],
      ["–ú–∞–¥–∂—É–Ω—ä—Ç –±–µ—à–µ –∫–∞—Ç–∞—Å—Ç—Ä–æ—Ñ–∞, –Ω–æ –∞–∑ —Å—ä–º —â–∞—Å—Ç–ª–∏–≤ –æ—Ü–µ–ª—è–ª üòé", "–°–º—è—Ö", "üòé"],

      // –ú–µ—á—Ç–∏ (10)
      ["–ï–¥–∏–Ω –¥–µ–Ω —â–µ –æ—Ç–∏–¥–µ–º –Ω–∞ –º—è—Å—Ç–æ, –∫—ä–¥–µ—Ç–æ –Ω—è–º–∞ –Ω–∏–∫–æ–π –æ—Å–≤–µ–Ω –Ω–∞—Å!", "–ú–µ—á—Ç–∏", "üåå"],
      ["–ò—Å–∫–∞–º –¥–∞ –ø—Ä–∞–≤–∏–º –ø–æ–≤–µ—á–µ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–∏ –ø—ä—Ç—É–≤–∞–Ω–∏—è!", "–ú–µ—á—Ç–∏", "‚úàÔ∏è"],
      ["–û–±–µ—â–∞–≤–∞–º, —á–µ –≤–∏–Ω–∞–≥–∏ —â–µ –±—ä–¥–∞ –¥–æ —Ç–µ–± –∏ —â–µ —Ç–µ –æ–±–∏—á–∞–º!", "–ú–µ—á—Ç–∏", "ü§ù"],
      ["–í–∏–∂–¥–∞–º –Ω–∏ –∑–∞–µ–¥–Ω–æ, –¥–æ—Ä–∏ –∫–æ–≥–∞—Ç–æ –æ—Å—Ç–∞—Ä—è–≤–∞–º–µ!", "–ú–µ—á—Ç–∏", "üåÖ"],
      ["–ú–µ—á—Ç–∞—è –∑–∞ –≤—Å–∏—á–∫–∏ –º–æ–º–µ–Ω—Ç–∏, –∫–æ–∏—Ç–æ –æ—â–µ –Ω–µ —Å–º–µ —Å—ä–∑–¥–∞–ª–∏!", "–ú–µ—á—Ç–∏", "üå†"],
      ["–î–∞ –≥–ª–µ–¥–∞–º–µ —Å–µ–≤–µ—Ä–Ω–æ—Ç–æ —Å–∏—è–Ω–∏–µ –∑–∞–µ–¥–Ω–æ!", "–ú–µ—á—Ç–∏", "üéá"],
      ["–£–∏–∫–µ–Ω–¥ –¥–æ–º –∫—Ä–∞–π –º–æ—Ä–µ—Ç–æ ‚Äì —Å–∞–º–æ –Ω–∏–µ –¥–≤–∞–º–∞—Ç–∞!", "–ú–µ—á—Ç–∏", "üè°"],
      ["–î–∞ —Å–∏ –∏–º–∞–º–µ –Ω–∞—à–∞ –Ω–µ–¥–µ–ª–Ω–∞ —Ç—Ä–∞–¥–∏—Ü–∏—è!", "–ú–µ—á—Ç–∏", "üóìÔ∏è"],
      ["–î–∞ –∏–º–∞–º–µ –∫–æ–ø–∏–µ –Ω–∞ –Ω–∞—Å, –Ω–æ –¥–∞ –µ —Å —Ç–≤–æ–∏—Ç–µ –æ—á–∏!", "–ú–µ—á—Ç–∏", "üçù"],
      ["–ê–ª–±—É–º ‚Äû–Ω–∞—à–∏—è—Ç –∂–∏–≤–æ—Ç‚Äú ‚Äì —Å–Ω–∏–º–∫–∞ –≤—Å–µ–∫–∏ –º–µ—Å–µ—Ü!", "–ú–µ—á—Ç–∏", "üìî"],

      // –ü–∞–ª–∞–≤–æ (10)
      ["–¢–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞ —Ç–∏ –∑–∞–±—Ä–∞–Ω—è–≤–∞–º –¥–∞ –∑–∞—Å–ø–∏–≤–∞—à‚Ä¶ –±–µ–∑ –¥–∞ –º–µ —Ü–µ–ª—É–Ω–µ—à.", "–ü–∞–ª–∞–≤–æ", "üòà"],
      ["–ù–µ –º–æ–≥–∞ –¥–∞ —Å–ø—Ä–∞ –¥–∞ –º–∏—Å–ª—è –∑–∞ —Ç–µ–±‚Ä¶ –∏ –∑–∞ —Ç–≤–æ–µ—Ç–æ —Ç—è–ª–æ.", "–ü–∞–ª–∞–≤–æ", "üòè"],
      ["–ú–∞–¥–∂—É–Ω—ä—Ç –±–µ—à–µ —Å–∞–º–æ –Ω–∞—á–∞–ª–æ—Ç–æ –Ω–∞ –Ω–∞—à–∏—Ç–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è üòâ", "–ü–∞–ª–∞–≤–æ", "üòú"],
      ["–°–ª–µ–¥–≤–∞—â–∏—è –ø—ä—Ç, –∫–æ–≥–∞—Ç–æ —Å–º–µ —Å–∞–º–∏, –≥–æ—Ç–≤–∏ —Å–µ –∑–∞ –∏–∑–Ω–µ–Ω–∞–¥–∞.", "–ü–∞–ª–∞–≤–æ", "üî•"],
      ["–û–±–∏—á–∞–º –¥–∞ —Ç–µ –¥—Ä–∞–∑–Ω—è, –∑–∞—â–æ—Ç–æ –∑–Ω–∞–º –∫–∞–∫ —â–µ —Å–µ –∑–∞—Å–º–µ–µ—à.", "–ü–∞–ª–∞–≤–æ", "üòá"],
      ["–ù—è–º–∞–º —Ç—ä—Ä–ø–µ–Ω–∏–µ –∑–∞ –Ω–∞—à–∏—Ç–µ ‚Äû—Ç–∞–π–Ω–∏ –∏–≥—Ä–∏‚Äú —Ç–∞–∑–∏ –≤–µ—á–µ—Ä.", "–ü–∞–ª–∞–≤–æ", "üòâ"],
      ["–®–µ–ø–æ—Ç –≤ —Ç—ä–º–Ω–æ—Ç–æ: –∏–º–∞–º –ø–ª–∞–Ω –∑–∞ –Ω–∞—Å.", "–ü–∞–ª–∞–≤–æ", "üñ§"],
      ["–ò–º–∞—à –µ–¥–∏–Ω –≤–∞—É—á–µ—Ä –∑–∞ –¥—ä–ª–≥–∏ —Ü–µ–ª—É–≤–∫–∏.", "–ü–∞–ª–∞–≤–æ", "üíã"],
      ["–†–∞–∑—Ö–æ–¥–∫–∞ —Å —Ä—ä—Ü–µ –ø–æ–¥ —è–∫–µ—Ç–æ ‚Äì —Å–∞–º–æ –Ω–∞—à–∞—Ç–∞ —Ç–∞–π–Ω–∞.", "–ü–∞–ª–∞–≤–æ", "ü´∂"],
      ["–í–µ—á–µ—Ä —Å—ä—Å —Å–≤–µ—â–∏, –º—É–∑–∏–∫–∞ –∏‚Ä¶ –æ—Å—Ç–∞–Ω–∞–ª–æ—Ç–æ —â–µ –∏–∑–º–∏—Å–ª–∏–º.", "–ü–∞–ª–∞–≤–æ", "üïØÔ∏è"],

      // –ò–∑–Ω–µ–Ω–∞–¥–∞ (10)
      ["–¢–∞—Ç—É–∏—Ä–æ–≤–∫–∞ –ø–æ-—Ç–≤–æ–π –∏–∑–±–æ—Ä.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "‚úçÔ∏è"],
      ["–¢–∞–π–Ω–∞ –±–µ–ª–µ–∂–∫–∞ –≤ —á–∞–Ω—Ç–∞—Ç–∞ —Ç–∏.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üìù"],
      ["–í–µ—á–µ—Ä—è ‚Äû–∏–∑–Ω–µ–Ω–∞–¥–∞‚Äú ‚Äì –≥–æ—Ç–≤—è –∞–∑.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üçΩÔ∏è"],
      ["–¢–∏ –∏–∑–±–∏—Ä–∞—à –º—è—Å—Ç–æ, –∞–∑ –ø–ª–∞–Ω–∏—Ä–∞–º –≤—Å–∏—á–∫–æ.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üó∫Ô∏è"],
      ["–°–Ω–∏–º–∫–∞ —Å–∞–º–æ –Ω–∞ —É—Å–º–∏–≤–∫–∞—Ç–∞ —Ç–∏ –¥–Ω–µ—Å. –©–µ —è —Ä–∞–º–∫–∏—Ä–∞–º.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üì∑"],
      ["–ú–∞–ª—ä–∫ –ø–æ–¥–∞—Ä—ä–∫ –±–µ–∑ –ø–æ–≤–æ–¥ (—â–µ —Ä–∞–∑–±–µ—Ä–µ—à üòâ).", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üéÅ"],
      ["10-–º–∏–Ω—É—Ç–µ–Ω –º–∞—Å–∞–∂ ‚Äì –∫–æ–≥–∞—Ç–æ –ø–æ–∏—Å–∫–∞—à.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üíÜ‚Äç‚ôÄÔ∏è"],
      ["–ü–ª–µ–π–ª–∏—Å—Ç ‚Äû–ú–µ–ª–∏—Å–∞‚Äú ‚Äì —Å–∞–º–æ –Ω–∞—à–∏ –ø–µ—Å–Ω–∏.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üéµ"],
      ["–ï–¥–Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–µ–¥–∏ —Å—ä–Ω ‚Äì –æ—Ç –º–µ–Ω.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üìñ"],
      ["–ü–∏–∫–Ω–∏–∫ –Ω–∞ –ø–æ–¥–∞ —É –¥–æ–º–∞ ‚Äì —Ç–∞–∑–∏ —Å–µ–¥–º–∏—Ü–∞.", "–ò–∑–Ω–µ–Ω–∞–¥–∞", "üß∫"]
    ];

    // DOM
    const cats = document.getElementById('cats');
    const fortuneEl = document.getElementById('fortune');
    const leftEl = document.getElementById('left');
    const limitNote = document.getElementById('limitNote');
    const randomBtn = document.getElementById('randomBtn');
    const resetBtn = document.getElementById('resetBtn');
    const todayInfo = document.getElementById('todayInfo');

    const LS_SEEN = 'seenFortunes_v7';
    const LS_LAST_DATE = 'lastOpenDate_v7';

    // Build chips with counters
    const CAT_COLORS2 = {"–†–æ–º–∞–Ω—Ç–∏–∫–∞":"#ff6ec7","–°–ø–æ–º–µ–Ω–∏":"#76c7ff","–ñ–µ—Å—Ç–æ–≤–µ":"#66ffa3","–°–º—è—Ö":"#ffd166","–ú–µ—á—Ç–∏":"#a2ffea","–ü–∞–ª–∞–≤–æ":"#c18cff","–ò–∑–Ω–µ–Ω–∞–¥–∞":"#ff9f7f"};
    const CAT_COL_COUNTER = {}; // name -> span
    const CAT_NAMES2 = Object.keys(CAT_COLORS2);
    function buildCategoryChips(){
      cats.innerHTML='';
      const totals = {};
      fortunes.forEach(f=> totals[f[1]]=(totals[f[1]]||0)+1);
      CAT_NAMES2.forEach(name=>{
        const chip = document.createElement('span');
        chip.className='chip'; chip.dataset.cat=name;
        const dot = document.createElement('span'); dot.className='dot'; dot.style.backgroundColor = CAT_COLORS2[name];
        const countSpan = document.createElement('span'); countSpan.className='count'; countSpan.textContent = totals[name]||0;
        chip.append(dot, document.createTextNode(' '+name+' ¬∑ '), countSpan);
        cats.appendChild(chip);
        CAT_COL_COUNTER[name]=countSpan;
      });
    }

    function todayStr(){ const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`;}
    function getSeenSet(){ try{ const raw=localStorage.getItem(LS_SEEN); return raw? new Set(JSON.parse(raw)): new Set(); }catch(e){ return new Set(); } }
    function setSeenSet(set){ localStorage.setItem(LS_SEEN, JSON.stringify([...set])); }
    function canOpenToday(){ return true; }
    function recordToday(){ /* unlimited mode */ }
    function updateLeftCounter(){ const seen=getSeenSet(); leftEl.textContent = String(Math.max(0, fortunes.length - seen.size)); }
    function updateTodayInfo(){ const last=localStorage.getItem(LS_LAST_DATE); todayInfo.textContent = last===todayStr()? '–≤–∑–µ—Ç–æ':'—Å–≤–æ–±–æ–¥–Ω–æ'; }
    function updateLimitUI(){ try{ randomBtn.disabled=false; limitNote.classList.add('hidden'); if (todayInfo) todayInfo.textContent='–±–µ–∑ –ª–∏–º–∏—Ç'; }catch(e){} }catch(e){} updateTodayInfo(); }

    function updateCategoryCounters(){
      const seen = getSeenSet();
      const totals = {}; fortunes.forEach(f=> totals[f[1]]=(totals[f[1]]||0)+1);
      const remaining = {...totals};
      seen.forEach(s=>{ const i=parseInt(s,10); if(!isNaN(i) && fortunes[i]){ const c=fortunes[i][1]; remaining[c]=Math.max(0,(remaining[c]||0)-1); } });
      CAT_NAMES2.forEach(n=>{ if(CAT_COL_COUNTER[n]) CAT_COL_COUNTER[n].textContent = String(remaining[n]||0); });
    }

    function pickRandom(){
      if(!canOpenToday()){ updateLimitUI(); return; }
      const seen=getSeenSet(); const rem=[];
      for(let i=0;i<fortunes.length;i++){ if(!seen.has(String(i))) rem.push(i); }
      const pool = rem.length? rem : [...Array(fortunes.length).keys()];
      const choice = pool[Math.floor(Math.random()*pool.length)];
      const [text, cat, emoji] = fortunes[choice];
      fortuneEl.textContent = `${emoji} ${text}  ‚Äî  ${cat}`;
      fortuneEl.style.borderColor = CAT_COLORS2[cat] || 'rgba(255,255,255,.12)';
      if(!seen.has(String(choice))){ seen.add(String(choice)); setSeenSet(seen); }
      updateLeftCounter(); updateCategoryCounters(); recordToday(); updateLimitUI();
      fortuneEl.animate([{transform:'scale(0.98)'},{transform:'scale(1)'}],{duration:150,easing:'ease-out'});
    }

    function handleReset(){
      localStorage.removeItem(LS_SEEN);
      localStorage.removeItem(LS_LAST_DATE);
      fortuneEl.textContent = "–ù—É–ª–∏—Ä–∞–Ω–æ ‚úÖ –ù–∞—Ç–∏—Å–Ω–∏ ‚Äû–û—Ç–≤–æ—Ä–∏ –∫—ä—Å–º–µ—Ç—á–µ, –ú–µ–ª–∏—Å–∞‚Äú üé≤";
      fortuneEl.style.borderColor = 'rgba(255,255,255,.12)';
      updateLeftCounter(); updateCategoryCounters(); updateLimitUI();
      showIntro(); // show intro again immediately for testing
    }

    // Init
    buildCategoryChips(); updateLeftCounter(); updateCategoryCounters(); updateLimitUI();

    // Listeners
    document.getElementById('randomBtn').addEventListener('click', pickRandom);
    document.getElementById('resetBtn').addEventListener('click', handleReset);
  

// ---- –ò—Å—Ç–æ—Ä–∏—è ----
const LS_HISTORY = 'kus_history_v1';
function loadHistory(){try{return JSON.parse(localStorage.getItem(LS_HISTORY)||'[]')}catch(e){return[]}}
function saveHistory(a){localStorage.setItem(LS_HISTORY,JSON.stringify(a.slice(-500)))}
function addHistoryEntry(text,cat){
  const now=new Date().toISOString();
  const arr=loadHistory();
  arr.push({text,cat,at:now});
  saveHistory(arr);
}
function fmt(d){return new Date(d).toLocaleString('bg-BG',{year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'})}
function renderHistory(){
  const list=document.getElementById('historyList');
  const items=loadHistory().slice().reverse();
  if(!items.length){list.innerHTML='<li><span class="t">–ù—è–º–∞ –∑–∞–ø–∏—Å–∏ –æ—â–µ.</span><span class="d"></span></li>';return;}
  list.innerHTML=items.map(i=>`<li><span class="t">${i.cat?`<strong>${i.cat}:</strong> `:''}${i.text}</span><span class="d">${fmt(i.at)}</span></li>`).join('');
}
const historyBtn=document.getElementById('historyBtn');
const historyModal=document.getElementById('historyModal');
const historyClose=document.getElementById('historyClose');
const historyClose2=document.getElementById('historyClose2');
const historyCloseBackdrop=document.getElementById('historyCloseBackdrop');
const historyClear=document.getElementById('historyClear');
function openHistory(){historyModal.classList.remove('hidden');renderHistory();}
function closeHistory(){historyModal.classList.add('hidden');}
historyBtn?.addEventListener('click',openHistory);
historyClose?.addEventListener('click',closeHistory);
historyClose2?.addEventListener('click',closeHistory);
historyCloseBackdrop?.addEventListener('click',closeHistory);
historyClear?.addEventListener('click',()=>{if(confirm('–î–∞ –∏–∑—á–∏—Å—Ç—è –∏—Å—Ç–æ—Ä–∏—è—Ç–∞?')){saveHistory([]);renderHistory();}});

// –ó–∞–ø–∏—Å –Ω–∞ –∏—Å—Ç–æ—Ä–∏—è –ø—Ä–∏ –∏–∑—Ç–µ–≥–ª—è–Ω–µ
// –¢—ä—Ä—Å–∏–º –º—è—Å—Ç–æ—Ç–æ –∫—ä–¥–µ—Ç–æ —Å–µ –∏–∑–ø–∏—Å–≤–∞ –∫—Ä–∞–π–Ω–æ—Ç–æ –∫—ä—Å–º–µ—Ç—á–µ –∏ –∑–∞–∫–∞—á–∞–º–µ
const _origShowFortune = window.showFortune;
if (typeof _origShowFortune === 'function'){
  window.showFortune = function(text, cat){
    try{ addHistoryEntry(String(text||''), String(cat||'')); }catch(e){}
    return _origShowFortune.apply(this, arguments);
  }
}

</script>

<!-- HISTORY MODAL -->
<div id="historyModal" class="modal hidden">
  <div class="modal__backdrop" id="historyCloseBackdrop"></div>
  <div class="modal__dialog">
    <div class="modal__header">
      <div class="modal__title">–ò—Å—Ç–æ—Ä–∏—è –Ω–∞ –∫—ä—Å–º–µ—Ç—á–µ—Ç–∞—Ç–∞</div>
      <button id="historyClose" class="chip">‚úñ</button>
    </div>
    <div class="modal__body">
      <ul id="historyList" class="history-list"></ul>
    </div>
    <div class="modal__footer">
      <button id="historyClear" class="chip">üßπ –ò–∑—á–∏—Å—Ç–∏</button>
      <button id="historyClose2" class="chip">–ó–∞—Ç–≤–æ—Ä–∏</button>
    </div>
  </div>
</div>

</body>
</html>
